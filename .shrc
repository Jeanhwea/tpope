# -*- sh -*- vim: ft=sh sw=4 sts=4
# $Id$

# This location of this file is normally in $ENV, so that it is sourced by the
# bourne shell on startup.  It is also sourced by zsh, bash, and ksh, from
# .zshrc, .bashrc, and .profile, respectively.

for dir in /usr/ucb /usr/local/bin /opt/local/bin /opt/sfw/bin; do
    if [ -d "$dir" ]; then
	case "$PATH" in
	    *"$dir"*) ;;
	    *) PATH="$dir$PATH" ;;
	esac
    fi
done

for dir in /usr/bin /bin /usr/bin/X11 /opt/sfw/kde/bin /usr/openwin/bin /usr/dt/bin /usr/games /usr/bin/surfraw-elvi /usr/lib/surfraw /usr/local/sbin /usr/sbin /sbin /usr/etc; do
    if [ -d "$dir" ]; then
	case "$PATH" in
	    *:"$dir":*|*:"$dir"|"$dir":*|"$dir") ;;
	    *) PATH="$PATH$dir" ;;
	esac
    fi
done

case "$PATH" in
    "$HOME"/bin:*) ;;
    *) PATH="$HOME/bin:$PATH" ;;
esac

if [ -f "$HOME/.locale" -a -z "$LANG" -a -z "$LC_ALL" ]; then
    LANG="`cat "$HOME/.locale"`"
    export LANG
fi

CLASSPATH=.
[ -d "$HOME/.java" ] && CLASSPATH="$CLASSPATH$HOME/.java"
[ -d "$HOME/java" ]  && CLASSPATH="$CLASSPATH$HOME/java"

[ -d "$HOME/.ruby" ] && RUBYLIB="$HOME/.ruby"

for dir in "$HOME/.perl5" "$HOME/perl5" "$HOME/.perl" "$HOME/perl"; do
    case ":$PERL5LIB:" in
        *:"$dir":*) ;;
        *) [ ! -d "$dir" ] || PERL5LIB="$PERL5LIB$dir"
    esac
done
PERL5LIB="`echo "$PERL5LIB"|sed -e s/^://`"
[ ! -f "$HOME/.perl/Echo.pm" ] || case "$PERL5OPT" in
   *Echo*) ;;
   '') PERL5OPT="-MEcho" ;;
   *)  PERL5OPT="$PERL5OPT -MEcho" ;;
esac

export PATH CLASSPATH PERL5LIB PERL5OPT RUBYLIB RUBYOPT

RSYNC_RSH='ssh -axqoBatchmode=yes'
CVS_RSH='ssh'
CVSROOT=':ext:iling.us:/home/tpope/.cvs'
[ "`hostname`" != gob ] || CVSROOT="$HOME/.cvs"
LYNX_CFG="$HOME/.lynx.cfg"
export RSYNC_RSH CVS_RSH CVSROOT LYNX_CFG

ulim="ulimit -S -u"
$ulim >/dev/null 2>/dev/null || ulim="ulimit -S -p"
unum=256
[ -z "$CRON" ] || unum=128
cunum="`$ulim 2>/dev/null`"
case "$cunum" in [0-9]*) ;; *) cunum=65535 ;; esac
[ "$unum" -ge "$cunum" ] || $ulim "$unum" 2>/dev/null
unset ulim unum cunum

if [ -t 1 ]; then

RSYNC_RSH='ssh -ax'

hostname=`hostname|sed -e 's/[.].*//'`
[ "$TERM" = Eterm -o "$TERM" = Eterm-xterm ] && \
    echo -n "]I$hostname.xpm\\"
[ "$TERM" = linux ] && TMOUT=43200

if [ "$interactive" -o "$_" = "interactive" ] || \
    echo $0|grep '^[^.]*sh[0-9.-]*$' >/dev/null; then

    VISUAL="$HOME/bin/sensible-editor"
    BROWSER="$HOME/bin/sensible-browser"
    PAGER="$HOME/bin/sensible-pager"
    [ -x /usr/bin/lesspipe ] && LESSOPEN='|lesspipe %s'

    umask 022
    stty -ixon

    #oldterm="$TERM"
    #[ "$OLDTERM" ] && oldterm="$OLDTERM"
    case "$TERM" in
	screen*|vt220*)
	if [ -x /usr/bin/tty -o -x /usr/local/bin/tty ]; then
	    echo -n "k`tty|sed -e 's,^/dev/,,' -e 's,/,-,g'`@$hostname\\"
	    echo -n "]1;`tty|sed -e 's,^/dev/,,' -e 's,/,-,g'`@$hostname"
	else
	    echo -n "k$hostname\\"
	    echo -n "]1;$hostname"
	fi
	;;
	xterm*|rxvt*|kterm*|dtterm*|cygwin*)
	if [ -x /usr/bin/tty -o -x /usr/local/bin/tty ]; then
	echo -n "]1;`tty|sed -e 's,^/dev/,,' -e 's,/,-,g'`@$hostname"
	else
	    echo -n "]1;$hostname"
	fi ;;
	Eterm*)
	if [ -x /usr/bin/tty -o -x /usr/local/bin/tty ]; then
	    echo -n "]1;`tty|sed -e 's,^/dev/,,' -e 's,/,-,g'`@$hostname"
	else
	    echo -n "]1;$hostname"
	fi
	;;
    esac

    execbin=`echo $0|sed -e 's/^-//' -e 's/\.shrc/_/'`

    if [ "`id|sed -e 's/^uid=\([0-9]*\).*$/\1/'`" -eq 0 ]; then
	promptchar='#'
    else
	promptchar='$'
	[ "`id|sed -e 's/^.*gid=[0-9]*(\([^)]*\)).*/\1/'`" = "$LOGNAME" ] && \
	umask 002
    fi

    PS1="$LOGNAME@$hostname `basename "$execbin"`$promptchar "

    #case `basename "$execbin"` in
    #*ksh*)
       #PS1="`whoami`@$hostname$HOME,~,"`'"$promptchar "
	#;;
    #esac

    if [ "`basename "$execbin"`" != sh ]; then

	alias ls='ls -F'

	alias mv='mv -i'
	alias cp='cp -i'
	alias rm="$HOME/bin/tpope rm"

	alias j='jobs'

	[ -x /usr/bin/vim -o -x /usr/local/bin/vim -o -x /opt/sfw/bin/vim ] && \
	    alias vi='vim'
	[ -x /usr/bin/gvim -o -x /usr/local/bin/gvim -o -x /opt/sfw/bin/gvim ] && \
	    alias vi='vim' # -X

	if [ -x "`which dircolors 2>/dev/null`" ]; then
	    eval `dircolors -b "$HOME/.dir_colors"`
	    alias ls="ls -F --color=auto"
	elif [ -x "`which gdircolors 2>/dev/null`" ]; then
	    eval `gdircolors -b "$HOME/.dir_colors"`
	    alias ls="gls -F --color=auto"
	fi

	if ! grep --color 2>&1 | grep unknown >/dev/null; then
	    alias grep='grep --color=auto'
	fi

	if [ -f /etc/debian_version -a "`uname`" = Linux ]; then
	    alias less='less -R'
	    alias zless='zless -R'
	    #PAGER='less -R'
	fi

	unalias stop >/dev/null 2>&1
	for cmd in `tpope aliases`; do
	    if [ -x "`which $cmd 2>/dev/null`" ]; then
		eval "${cmd}() { tpope $cmd \"\$@\"; }"
	    else
		alias $cmd="$HOME/bin/tpope $cmd"
	    fi
	done

	if [ -x "`which finger 2>/dev/null`" -a -f "$HOME/.hushlogin" ]; then
	    if finger $LOGNAME 2>/dev/null|grep "^New mail" >/dev/null 2>/dev/null; then
		echo "You have new mail."
	    fi
	elif [ "$LS_COLORS" -a -f "$HOME/.hushlogin" -a -f "$MAIL" ]; then
	    [ "$MAIL" -o ! -f /var/mail/$LOGNAME ] || MAIL=/var/mail/$LOGNAME
	    [ "$MAIL" -o ! -f /var/spool/mail/$LOGNAME ] || MAIL=/var/mail/$LOGNAME
	    mtime=-1 atime=-1
	    mtime=`ls -l --time-style=+%s "$MAIL"|awk '{print $6}'`
	    atime=`ls -ul --time-style=+%s "$MAIL"|awk '{print $6}'`
	    if [ "`expr $mtime - $atime`" -gt 0 ]; then
		echo "You have new mail."
	    fi
	fi

	set -o emacs -o noclobber >/dev/null 2>&1

    fi
    export VISUAL PAGER LESSOPEN LESSCHARSET PS1
fi
unset promptchar interactive execbin hostname oldterm dir mtime atime
fi

test -f "$HOME/.shrc.local" && . "$HOME/.shrc.local"
